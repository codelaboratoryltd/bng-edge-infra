# Log rotation configuration for Nexus security audit logs
# Install: sudo cp nexus-audit.conf /etc/logrotate.d/nexus-audit

/var/log/nexus/audit.log {
    # Rotate daily
    daily

    # Keep 90 days of logs (configurable based on retention policy)
    rotate 90

    # Compress rotated logs
    compress

    # Delay compression to allow continued writing
    delaycompress

    # Don't rotate if empty
    notifempty

    # Create new log file with appropriate permissions
    create 0640 nexus nexus

    # Handle missing log file gracefully
    missingok

    # Add date to rotated filename
    dateext
    dateformat -%Y%m%d

    # Use sharedscripts to run postrotate only once
    sharedscripts

    # Signal Nexus to reopen log files after rotation
    postrotate
        /usr/bin/systemctl kill -s HUP nexus.service 2>/dev/null || true
    endscript
}

# API access logs (1 year retention)
/var/log/nexus/api-audit.log {
    daily
    rotate 365
    compress
    delaycompress
    notifempty
    create 0640 nexus nexus
    missingok
    dateext
    dateformat -%Y%m%d
    sharedscripts
    postrotate
        /usr/bin/systemctl kill -s HUP nexus.service 2>/dev/null || true
    endscript
}

# Security-specific audit logs (2 years retention for compliance)
/var/log/nexus/security-audit.log {
    daily
    rotate 730
    compress
    delaycompress
    notifempty
    create 0640 nexus nexus
    missingok
    dateext
    dateformat -%Y%m%d
    sharedscripts
    postrotate
        /usr/bin/systemctl kill -s HUP nexus.service 2>/dev/null || true
    endscript
}

# Resource allocation logs (1 year retention)
/var/log/nexus/resource-audit.log {
    daily
    rotate 365
    compress
    delaycompress
    notifempty
    create 0640 nexus nexus
    missingok
    dateext
    dateformat -%Y%m%d
    sharedscripts
    postrotate
        /usr/bin/systemctl kill -s HUP nexus.service 2>/dev/null || true
    endscript
}
