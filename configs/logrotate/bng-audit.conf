# Log rotation configuration for BNG security audit logs
# Install: sudo cp bng-audit.conf /etc/logrotate.d/bng-audit

/var/log/bng/audit.log {
    # Rotate daily
    daily

    # Keep 90 days of logs (configurable based on retention policy)
    rotate 90

    # Compress rotated logs
    compress

    # Delay compression to allow continued writing
    delaycompress

    # Don't rotate if empty
    notifempty

    # Create new log file with appropriate permissions
    create 0640 bng bng

    # Handle missing log file gracefully
    missingok

    # Add date to rotated filename
    dateext
    dateformat -%Y%m%d

    # Use sharedscripts to run postrotate only once
    sharedscripts

    # Signal BNG to reopen log files after rotation
    postrotate
        /usr/bin/systemctl kill -s HUP bng.service 2>/dev/null || true
    endscript
}

# Security-specific audit logs (longer retention - 2 years for compliance)
/var/log/bng/security-audit.log {
    daily
    rotate 730
    compress
    delaycompress
    notifempty
    create 0640 bng bng
    missingok
    dateext
    dateformat -%Y%m%d
    sharedscripts
    postrotate
        /usr/bin/systemctl kill -s HUP bng.service 2>/dev/null || true
    endscript
}

# NAT logging (legal requirement - varies by jurisdiction)
/var/log/bng/nat-audit.log {
    daily
    rotate 365
    compress
    delaycompress
    notifempty
    create 0640 bng bng
    missingok
    dateext
    dateformat -%Y%m%d
    sharedscripts
    postrotate
        /usr/bin/systemctl kill -s HUP bng.service 2>/dev/null || true
    endscript
}

# Session logs (1 year retention)
/var/log/bng/session-audit.log {
    daily
    rotate 365
    compress
    delaycompress
    notifempty
    create 0640 bng bng
    missingok
    dateext
    dateformat -%Y%m%d
    sharedscripts
    postrotate
        /usr/bin/systemctl kill -s HUP bng.service 2>/dev/null || true
    endscript
}
