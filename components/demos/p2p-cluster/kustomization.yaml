apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

# Demo C: Nexus P2P Cluster with DNS Discovery
# Demonstrates CRDT synchronization with peer discovery via Kubernetes headless service DNS.
# This is simpler than rendezvous discovery as it doesn't require a separate server component.
#
# How it works:
# 1. Each Nexus pod queries the headless service DNS (nexus.namespace.svc.cluster.local)
# 2. DNS returns all pod IPs in the StatefulSet
# 3. Nexus connects to each discovered peer IP on the P2P port
# 4. Readiness probe waits for peer discovery before marking pod ready

namespace: demo-p2p

resources:
  - namespace.yaml
  - ../../base/nexus-p2p

namePrefix: p2p-

labels:
  - pairs:
      demo: p2p

# Scale to 3 replicas for cluster testing
replicas:
  - name: nexus
    count: 3

patches:
  - path: patch-dns-discovery.yaml
